$(document).ready(()=>{let e=!1,s=void 0,n="";const a=navigator.platform.toUpperCase().indexOf("MAC")>=0;let i;i=a?new Audio("/audio/message.m4r"):new Audio("/audio/message.mp3"),d(),$("#send").click(()=>{const e=$("#chatbox").val();""!=e&&(t.emit("chat_message",e),$("#chatbox").val(""))}),$("#chatbox").keyup(e=>{13===e.keyCode&&(e.preventDefault(),$("#send").click())});const t=io.connect();t.on("chat_message",e=>{if(n==e.username){const s='<div class="message_box">\n                      <div class="my">\n                        <div class="my_message new"></div>\n                      </div>\n                    </div>';$(".typing_message:first").length?$(".typing_message:first").parent().parent().before(s):$(".main").append(s),$(".my_message").last().text(e.msg)}else{const s='<div class="message_box">\n                      <div class="sender"></div>\n                      <div class="recieved">\n                        <div class="message new"></div>\n                      </div>\n                    </div>';$(".typing_message:first").length?$(".typing_message:first").parent().parent().before(s):$(".main").append(s),$(".message").last().text(e.msg),$(".sender").last().text(e.username)}i.play(),m()}),t.on("typing",e=>{$(".main").append(`<div id="${escape(e)}" class="message_box">\n                            <div class="recieved">\n      \t                       <div class="typing_message"></div>\n                            </div>\n                         </div>`),$(".typing_message").last().text(`${e} is typing...`)}),t.on("stopped_typing",e=>{$(`#${escape(e)}`).remove()}),t.on("joined_chat",e=>{$(".main").append('<div class="message_box">\n                        <div class="recieved">\n    \t                   <div class="join_message"></div>\n                        </div>\n                       </div>'),$(".join_message").last().text(`${e} joined the chat.`),m()}),t.on("left_chat",e=>{$(".main").append('<div class="message_box">\n                          <div class="recieved">\n    \t                       <div class="join_message"></div>\n                          </div>\n                       </div>'),$(".join_message").last().text(`${e} left the chat.`),m()}),t.on("online",(e,s)=>{$("#num").html(`Online: ${e}`),$("#online").empty(),s.forEach(e=>{$("#online").append($("<p>").text(e))})}),window.onbeforeunload=(e=>{t.emit("left")});const d=()=>{const e=window.location.pathname.split("/").pop();$.get(`/room/${e}/messages`,s=>{$(".main").empty(),n=s.username,s.messages.forEach(e=>{s.username==e.sender?($(".main").append('<div class="message_box">\n                            <div class="my">\n        \t                    <div class="my_message"></div>\n                            </div>\n                           </div>'),$(".my_message").last().text(e.message)):($(".main").append('<div class="message_box">\n        \t                   <div class="sender"></div>\n                             <div class="recieved">\n        \t                     <div class="message"></div>\n                             </div>\n                            </div>'),$(".message").last().text(e.message),$(".sender").last().text(e.sender))}),t.emit("username",e)})},m=()=>{$(".main").animate({scrollTop:$(".main").prop("scrollHeight")},1e3)};$("#chatbox").keydown(()=>{0==e?(e=!0,t.emit("typing"),s=setTimeout(o,5e3)):(clearTimeout(s),s=setTimeout(o,5e3))});const o=()=>{e=!1,t.emit("stopped_typing")}});
